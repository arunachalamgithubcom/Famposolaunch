import * as tslib_1 from "tslib";
import { FormControl } from "@angular/forms";
import { ObjectMaker } from "../util/object-maker";
import { MESSAGE, CONTROLS_ERROR, VALUE_CHANGED_SYNC } from '../const';
import { ApplicationUtil } from '../util/app-util';
import { DisableProvider } from '../domain/disable-provider';
import { RXCODE, MODEL_INSTANCE, PATCH } from "../const/app.const";
import { DECORATORS } from "../const/decorators.const";
import { defaultContainer } from "../core/defaultContainer";
import { SANITIZERS } from "../util/sanitizers";
import { ErrorMessageBindingStrategy } from "../enums";
import { ReactiveFormConfig } from "../util/reactive-form-config";
var DIRTY = "dirty";
var TOUCHED = "touched";
var UNTOUCHED = "untouched";
var PRISTINE = "pristine";
var PENDING = "pending";
var RxFormControl = /** @class */ (function (_super) {
    tslib_1.__extends(RxFormControl, _super);
    function RxFormControl(formState, validator, asyncValidator, entityObject, baseObject, controlName, _sanitizers) {
        var _this = _super.call(this, formState, validator, asyncValidator) || this;
        _this.entityObject = entityObject;
        _this.baseObject = baseObject;
        _this._sanitizers = _sanitizers;
        _this._errorMessages = [];
        _this._childColumns = [];
        _this._refDisableControls = [];
        _this._refMessageControls = [];
        _this._refClassNameControls = [];
        _this._isPassedExpression = false;
        _this._dirty = false;
        _this._baseValue = formState === undefined ? null : _this.getFormState(formState);
        _this._isModified = false;
        _this.keyName = controlName;
        _this._errorMessageBindingStrategy = ReactiveFormConfig.get("reactiveForm.errorMessageBindingStrategy");
        if (_this._sanitizers) {
            var floatSanitizer = _this._sanitizers.filter(function (t) { return t.name == "toFloat"; })[0];
            if (floatSanitizer && _this._baseValue && ReactiveFormConfig.number && ReactiveFormConfig.number.decimalSymbol == ",") {
                var baseValue = String(_this._baseValue);
                if (baseValue.indexOf('.') != -1) {
                    _this._baseValue = baseValue.replace(".", ReactiveFormConfig.number.decimalSymbol);
                    _super.prototype.setValue.call(_this, _this._baseValue);
                }
            }
        }
        return _this;
    }
    Object.defineProperty(RxFormControl.prototype, "errors", {
        get: function () {
            return this._errors;
        },
        set: function (value) {
            this._errors = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessages", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessages.length == 0 && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return [];
            if (!this.errors && this._errorMessages.length > 0)
                this.setControlErrorMessages();
            return this._errorMessages;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessage", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessage == undefined && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return undefined;
            if (!this.errors && this._errorMessage)
                this.setControlErrorMessages();
            return this._errorMessage;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.getFormState = function (value) {
        var baseValue = value;
        if (Array.isArray(value)) {
            baseValue = [];
            value.forEach(function (t) { return baseValue.push(t); });
        }
        return baseValue;
    };
    Object.defineProperty(RxFormControl.prototype, "isModified", {
        get: function () {
            return this._isModified;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "dirty", {
        get: function () {
            return this._dirty;
        },
        set: function (value) {
            this._dirty = value;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.setValue = function (value, options) {
        var parsedValue = this.getSanitizedValue(value);
        if (options && options.dirty)
            this.baseObject[this.keyName] = value;
        this.entityObject[this.keyName] = parsedValue;
        _super.prototype.setValue.call(this, value, options);
        this.bindError();
        this.bindClassName();
        this.executeExpressions();
        this.callPatch();
        if (options && !options.updateChanged && this.root[VALUE_CHANGED_SYNC]) {
            this.root[VALUE_CHANGED_SYNC]();
        }
    };
    RxFormControl.prototype.getControlValue = function () {
        return this.getSanitizedValue(this.value);
    };
    RxFormControl.prototype.bindError = function () {
        if (this._messageExpression)
            this._isPassedExpression = this.executeExpression(this._messageExpression, this);
        this.setControlErrorMessages();
        this.errors = this.errors;
    };
    RxFormControl.prototype.bindClassName = function () {
        if (this.updateOnElementClass && typeof this.updateOnElementClass === "function") {
            var className = this.executeExpression(this._classNameExpression, this);
            var updateElement = this.updateOnElementClass;
            updateElement(className);
        }
    };
    RxFormControl.prototype.markAsTouched = function (opts) {
        var currentState = this.touched;
        _super.prototype.markAsTouched.call(this, opts);
        if (currentState != this.touched)
            this.runControlPropChangeExpression([TOUCHED, UNTOUCHED]);
    };
    RxFormControl.prototype.markAsUntouched = function (opts) {
        var currentState = this.untouched;
        _super.prototype.markAsUntouched.call(this, opts);
        if (currentState != this.untouched)
            this.runControlPropChangeExpression([UNTOUCHED, TOUCHED]);
    };
    RxFormControl.prototype.markAsDirty = function (opts) {
        var currentState = this.dirty;
        _super.prototype.markAsDirty.call(this, opts);
        this.dirty = true;
        if (currentState != this.dirty)
            this.runControlPropChangeExpression([DIRTY]);
    };
    RxFormControl.prototype.markAsPristine = function (opts) {
        var currentState = this.pristine;
        _super.prototype.markAsDirty.call(this, opts);
        if (currentState != this.pristine)
            this.runControlPropChangeExpression([PRISTINE]);
    };
    RxFormControl.prototype.markAsPending = function (opts) {
        var currentState = this.pending;
        _super.prototype.markAsDirty.call(this, opts);
        if (currentState != this.pending)
            this.runControlPropChangeExpression([PENDING]);
    };
    RxFormControl.prototype.runControlPropChangeExpression = function (propNames) {
        var _this = this;
        propNames.forEach(function (name) {
            if ((_this._controlProp && _this._messageExpression && _this._controlProp[name]) || (!_this._messageExpression && _this.checkErrorMessageStrategy()))
                _this.bindError();
            if (_this._classNameControlProp && _this._classNameControlProp[name])
                _this.bindClassName();
        });
    };
    RxFormControl.prototype.refresh = function () {
        this.getMessageExpression(this.parent, this.keyName);
        this.bindConditionalControls(DECORATORS.disabled, "_refDisableControls");
        this.bindConditionalControls(DECORATORS.error, "_refMessageControls");
        this.bindConditionalControls(DECORATORS.elementClass, "_refClassNameControls");
        this.executeExpressions();
        this.bindError();
    };
    RxFormControl.prototype.reset = function (value) {
        if (value !== undefined)
            this.setValue(value);
        else
            this.setValue(this.getFormState(this._baseValue));
        this.dirty = false;
    };
    RxFormControl.prototype.commit = function () {
        this._baseValue = this.value;
        this.callPatch();
    };
    RxFormControl.prototype.callPatch = function () {
        this._isModified = this.getValue(this._baseValue) != this.getValue(this.value);
        if (this.parent && this.parent[PATCH])
            this.parent[PATCH](this.keyName);
    };
    RxFormControl.prototype.checkErrorMessageStrategy = function () {
        var isBind = true;
        switch (this._errorMessageBindingStrategy) {
            case ErrorMessageBindingStrategy.OnSubmit:
                isBind = this.parent.submitted;
                break;
            case ErrorMessageBindingStrategy.OnDirty:
                isBind = this.dirty;
                break;
            case ErrorMessageBindingStrategy.OnTouched:
                isBind = this.touched;
                break;
            case ErrorMessageBindingStrategy.OnDirtyOrTouched:
                isBind = this.dirty || this.touched;
                break;
            case ErrorMessageBindingStrategy.OnDirtyOrSubmit:
                isBind = this.dirty || this.parent.submitted;
                break;
            case ErrorMessageBindingStrategy.OnTouchedOrSubmit:
                isBind = this.touched || this.parent.submitted;
                break;
            default:
                isBind = true;
        }
        return isBind;
    };
    RxFormControl.prototype.executeExpressions = function () {
        this.processExpression("_refDisableControls", "disabled");
        this.processExpression("_refMessageControls", "bindError");
        this.processExpression("_refClassNameControls", "bindClassName");
    };
    RxFormControl.prototype.getMessageExpression = function (formGroup, keyName) {
        if (formGroup[MODEL_INSTANCE]) {
            var instanceContainer = defaultContainer.get(formGroup[MODEL_INSTANCE].constructor);
            if (instanceContainer) {
                this._messageExpression = instanceContainer.nonValidationDecorators.error.conditionalExpressions[keyName];
                this._controlProp = instanceContainer.nonValidationDecorators.error.controlProp[this.keyName];
                this._classNameExpression = instanceContainer.nonValidationDecorators.elementClass.conditionalExpressions[keyName];
                this._classNameControlProp = instanceContainer.nonValidationDecorators.elementClass.controlProp[keyName];
                if (this._classNameExpression)
                    this.updateOnElementClass = true;
            }
        }
    };
    RxFormControl.prototype.getSanitizedValue = function (value) {
        var e_1, _a;
        if (this._sanitizers) {
            try {
                for (var _b = tslib_1.__values(this._sanitizers), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var sanitizer = _c.value;
                    value = SANITIZERS[sanitizer.name](value, sanitizer.config);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return value;
    };
    RxFormControl.prototype.bindConditionalControls = function (decoratorType, refName) {
        var _this = this;
        this._disableProvider = new DisableProvider(decoratorType, this.entityObject);
        this[refName] = this._disableProvider.zeroArgumentProcess(this, this.keyName);
        this._disableProvider.oneArgumentProcess(this, "" + this.keyName + RXCODE + "1").forEach(function (t) { return _this[refName].push(t); });
    };
    RxFormControl.prototype.setControlErrorMessages = function () {
        var _this = this;
        if ((!this._messageExpression && this.checkErrorMessageStrategy()) || this._isPassedExpression) {
            this._errorMessages = [];
            if (this.errors) {
                Object.keys(this.errors).forEach(function (t) {
                    if (_this.parent) {
                        _this.parent[CONTROLS_ERROR][_this.keyName] = _this._errorMessage = _this.getErrorMessage(_this.errors, t);
                        if (!_this._errorMessage) {
                            var errorObject = ObjectMaker.toJson(t, undefined, [_this.errors[t][t]]);
                            _this.parent[CONTROLS_ERROR][_this.keyName] = _this._errorMessage = _this.getErrorMessage(errorObject, t);
                        }
                    }
                    else
                        _this._errorMessage = _this.getErrorMessage(_this.errors, t);
                    _this._errorMessages.push(_this._errorMessage);
                });
            }
            else {
                this._errorMessage = undefined;
                if (this.parent) {
                    this.parent[CONTROLS_ERROR][this.keyName] = undefined;
                    delete this.parent[CONTROLS_ERROR][this.keyName];
                }
            }
        }
        else {
            this._errorMessages = [];
            this._errorMessage = undefined;
        }
    };
    RxFormControl.prototype.getErrorMessage = function (errorObject, keyName) {
        if (errorObject[keyName][MESSAGE])
            return errorObject[keyName][MESSAGE];
        return;
    };
    RxFormControl.prototype.processExpression = function (propName, operationType) {
        var e_2, _a;
        if (this[propName])
            try {
                for (var _b = tslib_1.__values(this[propName]), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var controlInfo = _c.value;
                    var control = controlInfo.isRoot ? ApplicationUtil.getControl(controlInfo.controlPath, ApplicationUtil.getRootFormGroup(this)) : ApplicationUtil.getFormControl(controlInfo.controlPath, this);
                    if (control) {
                        if (operationType == "disabled") {
                            var result = this.executeExpression(controlInfo.conditionalExpression, control);
                            if (result)
                                control.disable();
                            else
                                control.enable();
                        }
                        else if (operationType == "bindError")
                            control.bindError();
                        else if (operationType == "bindClassName")
                            control.bindClassName();
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
    };
    RxFormControl.prototype.executeExpression = function (expression, control) {
        return expression.call(control.parent[MODEL_INSTANCE], control, ApplicationUtil.getParentModelInstanceValue(this), control.parent[MODEL_INSTANCE]);
    };
    RxFormControl.prototype.getValue = function (value) {
        return value !== undefined && value !== null && value !== "" ? value : "";
    };
    return RxFormControl;
}(FormControl));
export { RxFormControl };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb250cm9sLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL2Zvcm0tY29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUE4QixXQUFXLEVBQXlELE1BQU0sZ0JBQWdCLENBQUM7QUFDaEksT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3RFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDbEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzVELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUUvQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDdkQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFbEUsSUFBTSxLQUFLLEdBQVcsT0FBTyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFXLFNBQVMsQ0FBQztBQUNsQyxJQUFNLFNBQVMsR0FBVyxXQUFXLENBQUM7QUFDdEMsSUFBTSxRQUFRLEdBQVcsVUFBVSxDQUFDO0FBQ3BDLElBQU0sT0FBTyxHQUFXLFNBQVMsQ0FBQztBQUVsQztJQUFtQyx5Q0FBVztJQXlEMUMsdUJBQVksU0FBYyxFQUFFLFNBQXNFLEVBQUUsY0FBNEQsRUFBVSxZQUFvQyxFQUFV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QUUsQ0FBQztJQUM5RSxDQUFDO0lBRUwsb0JBQUM7QUFBRCxDQUFDLEFBbldELENBQW1DLFdBQVcsR0FtVzdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybUdyb3VwLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sLCBWYWxpZGF0b3JGbiwgQXN5bmNWYWxpZGF0b3JGbiwgQWJzdHJhY3RDb250cm9sT3B0aW9ucyB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5pbXBvcnQgeyBPYmplY3RNYWtlciB9IGZyb20gXCIuLi91dGlsL29iamVjdC1tYWtlclwiO1xyXG5pbXBvcnQgeyBNRVNTQUdFLCBDT05UUk9MU19FUlJPUiwgVkFMVUVfQ0hBTkdFRF9TWU5DIH0gZnJvbSAnLi4vY29uc3QnXHJcbmltcG9ydCB7IEFwcGxpY2F0aW9uVXRpbCB9IGZyb20gJy4uL3V0aWwvYXBwLXV0aWwnXHJcbmltcG9ydCB7IERpc2FibGVQcm92aWRlciB9IGZyb20gJy4uL2RvbWFpbi9kaXNhYmxlLXByb3ZpZGVyJztcclxuaW1wb3J0IHsgUlhDT0RFLCBNT0RFTF9JTlNUQU5DRSwgUEFUQ0ggfSBmcm9tIFwiLi4vY29uc3QvYXBwLmNvbnN0XCJcclxuaW1wb3J0IHsgREVDT1JBVE9SUyB9IGZyb20gXCIuLi9jb25zdC9kZWNvcmF0b3JzLmNvbnN0XCI7XHJcbmltcG9ydCB7IGRlZmF1bHRDb250YWluZXIgfSBmcm9tIFwiLi4vY29yZS9kZWZhdWx0Q29udGFpbmVyXCI7XHJcbmltcG9ydCB7IFNBTklUSVpFUlMgfSBmcm9tIFwiLi4vdXRpbC9zYW5pdGl6ZXJzXCJcclxuaW1wb3J0IHsgRGF0YVNhbml0aXplciB9IGZyb20gJy4uL2NvcmUvdmFsaWRhdG9yLmludGVyZmFjZSdcclxuaW1wb3J0IHsgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5IH0gZnJvbSBcIi4uL2VudW1zXCI7XHJcbmltcG9ydCB7IFJlYWN0aXZlRm9ybUNvbmZpZyB9IGZyb20gXCIuLi91dGlsL3JlYWN0aXZlLWZvcm0tY29uZmlnXCI7XHJcblxyXG5jb25zdCBESVJUWTogc3RyaW5nID0gXCJkaXJ0eVwiO1xyXG5jb25zdCBUT1VDSEVEOiBzdHJpbmcgPSBcInRvdWNoZWRcIjtcclxuY29uc3QgVU5UT1VDSEVEOiBzdHJpbmcgPSBcInVudG91Y2hlZFwiO1xyXG5jb25zdCBQUklTVElORTogc3RyaW5nID0gXCJwcmlzdGluZVwiO1xyXG5jb25zdCBQRU5ESU5HOiBzdHJpbmcgPSBcInBlbmRpbmdcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBSeEZvcm1Db250cm9sIGV4dGVuZHMgRm9ybUNvbnRyb2wge1xyXG4gICAgcHJpdmF0ZSBrZXlOYW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIF9lcnJvck1lc3NhZ2U6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Vycm9yTWVzc2FnZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9kaXNhYmxlUHJvdmlkZXI6IERpc2FibGVQcm92aWRlcjtcclxuICAgIHByaXZhdGUgX2NvbHVtbnM6IHN0cmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBfY2hpbGRDb2x1bW5zOiBhbnkgPSBbXTtcclxuICAgIHByaXZhdGUgX3BhcmVudENvbHVtbnM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nW10gfTtcclxuICAgIHByaXZhdGUgX3JlZkRpc2FibGVDb250cm9scyA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfcmVmTWVzc2FnZUNvbnRyb2xzID0gW107XHJcbiAgICBwcml2YXRlIF9yZWZDbGFzc05hbWVDb250cm9scyA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5OiBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3k7XHJcbiAgICBwcml2YXRlIF9tZXNzYWdlRXhwcmVzc2lvbjogRnVuY3Rpb247XHJcbiAgICBwcml2YXRlIF9jbGFzc05hbWVFeHByZXNzaW9uOiBGdW5jdGlvbjtcclxuICAgIHByaXZhdGUgX2lzUGFzc2VkRXhwcmVzc2lvbjogQm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBfY29udHJvbFByb3A6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgcHJpdmF0ZSBfY2xhc3NOYW1lQ29udHJvbFByb3A6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgcHJpdmF0ZSBfYmFzZVZhbHVlOiBhbnk7XHJcbiAgICBwcml2YXRlIF9pc01vZGlmaWVkOiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBfZXJyb3JzOiBhbnk7XHJcbiAgICBwcml2YXRlIF9kaXJ0eTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgdXBkYXRlT25FbGVtZW50Q2xhc3M6IGJvb2xlYW4gfCBGdW5jdGlvbjtcclxuICAgIHByZUhvb2s6IEZ1bmN0aW9uO1xyXG4gICAgcG9zdEhvb2s6IEZ1bmN0aW9uO1xyXG5cclxuICAgIGdldCBlcnJvcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Vycm9ycztcclxuICAgIH1cclxuXHJcbiAgICBzZXQgZXJyb3JzKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl9lcnJvcnMgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0IGVycm9yTWVzc2FnZXMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGlmICghdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2Vycm9yTWVzc2FnZXMubGVuZ3RoID09IDAgJiYgdGhpcy5lcnJvcnMpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX21lc3NhZ2VFeHByZXNzaW9uICYmICF0aGlzLl9pc1Bhc3NlZEV4cHJlc3Npb24pXHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICBpZiAoIXRoaXMuZXJyb3JzICYmIHRoaXMuX2Vycm9yTWVzc2FnZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9lcnJvck1lc3NhZ2VzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBlcnJvck1lc3NhZ2UoKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAoIXRoaXMuX21lc3NhZ2VFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9lcnJvck1lc3NhZ2UgPT0gdW5kZWZpbmVkICYmIHRoaXMuZXJyb3JzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiAmJiAhdGhpcy5faXNQYXNzZWRFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICghdGhpcy5lcnJvcnMgJiYgdGhpcy5fZXJyb3JNZXNzYWdlKVxyXG4gICAgICAgICAgICB0aGlzLnNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Vycm9yTWVzc2FnZTtcclxuICAgIH1cclxuICAgIGNvbnN0cnVjdG9yKGZvcm1TdGF0ZTogYW55LCB2YWxpZGF0b3I6IFZhbGlkYXRvckZuIHwgQWJzdHJhY3RDb250cm9sT3B0aW9ucyB8IFZhbGlkYXRvckZuW10gfCBudWxsLCBhc3luY1ZhbGlkYXRvcjogQXN5bmNWYWxpZGF0b3JGbiB8IEFzeW5jVmFsaWRhdG9yRm5bXSB8IG51bGwsIHByaXZhdGUgZW50aXR5T2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBwcml2YXRlIGJhc2VPYmplY3Q6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGNvbnRyb2xOYW1lOiBzdHJpbmcsIHByaXZhdGUgX3Nhbml0aXplcnM6IERhdGFTYW5pdGl6ZXJbXSkge1xyXG4gICAgICAgIHN1cGVyKGZvcm1TdGF0ZSwgdmFsaWRhdG9yLCBhc3luY1ZhbGlkYXRvcilcclxuICAgICAgICB0aGlzLl9iYXNlVmFsdWUgPSBmb3JtU3RhdGUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0aGlzLmdldEZvcm1TdGF0ZShmb3JtU3RhdGUpO1xyXG4gICAgICAgIHRoaXMuX2lzTW9kaWZpZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmtleU5hbWUgPSBjb250cm9sTmFtZTtcclxuICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kgPSBSZWFjdGl2ZUZvcm1Db25maWcuZ2V0KFwicmVhY3RpdmVGb3JtLmVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneVwiKSBhcyBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3k7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Nhbml0aXplcnMpIHtcclxuICAgICAgICAgICAgdmFyIGZsb2F0U2FuaXRpemVyID0gdGhpcy5fc2FuaXRpemVycy5maWx0ZXIodCA9PiB0Lm5hbWUgPT0gXCJ0b0Zsb2F0XCIpWzBdXHJcbiAgICAgICAgICAgIGlmIChmbG9hdFNhbml0aXplciAmJiB0aGlzLl9iYXNlVmFsdWUgJiYgUmVhY3RpdmVGb3JtQ29uZmlnLm51bWJlciAmJiBSZWFjdGl2ZUZvcm1Db25maWcubnVtYmVyLmRlY2ltYWxTeW1ib2wgPT0gXCIsXCIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBiYXNlVmFsdWUgPSBTdHJpbmcodGhpcy5fYmFzZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVmFsdWUuaW5kZXhPZignLicpICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmFzZVZhbHVlID0gYmFzZVZhbHVlLnJlcGxhY2UoXCIuXCIsIFJlYWN0aXZlRm9ybUNvbmZpZy5udW1iZXIuZGVjaW1hbFN5bWJvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VwZXIuc2V0VmFsdWUodGhpcy5fYmFzZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGb3JtU3RhdGUodmFsdWUpIHtcclxuICAgICAgICBsZXQgYmFzZVZhbHVlID0gdmFsdWVcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgYmFzZVZhbHVlID0gW107XHJcbiAgICAgICAgICAgIHZhbHVlLmZvckVhY2godCA9PiBiYXNlVmFsdWUucHVzaCh0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiYXNlVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzTW9kaWZpZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTW9kaWZpZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRpcnR5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kaXJ0eVxyXG4gICAgfVxyXG5cclxuICAgIHNldCBkaXJ0eSh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWUodmFsdWU6IGFueSwgb3B0aW9ucz86IHtcclxuICAgICAgICBkaXJ0eT86IGJvb2xlYW47XHJcbiAgICAgICAgdXBkYXRlQ2hhbmdlZD86IGJvb2xlYW47XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgICAgIGVtaXRFdmVudD86IGJvb2xlYW47XHJcbiAgICAgICAgaXNUaHJvdWdoRHluYW1pYz86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHBhcnNlZFZhbHVlID0gdGhpcy5nZXRTYW5pdGl6ZWRWYWx1ZSh2YWx1ZSlcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRpcnR5KVxyXG4gICAgICAgICAgICB0aGlzLmJhc2VPYmplY3RbdGhpcy5rZXlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuZW50aXR5T2JqZWN0W3RoaXMua2V5TmFtZV0gPSBwYXJzZWRWYWx1ZTtcclxuICAgICAgICBzdXBlci5zZXRWYWx1ZSh2YWx1ZSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHRoaXMuYmluZEVycm9yKCk7XHJcbiAgICAgICAgdGhpcy5iaW5kQ2xhc3NOYW1lKCk7XHJcbiAgICAgICAgdGhpcy5leGVjdXRlRXhwcmVzc2lvbnMoKTtcclxuICAgICAgICB0aGlzLmNhbGxQYXRjaCgpO1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmICFvcHRpb25zLnVwZGF0ZUNoYW5nZWQgJiYgdGhpcy5yb290W1ZBTFVFX0NIQU5HRURfU1lOQ10pIHtcclxuICAgICAgICAgICAgdGhpcy5yb290W1ZBTFVFX0NIQU5HRURfU1lOQ10oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q29udHJvbFZhbHVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNhbml0aXplZFZhbHVlKHRoaXMudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRFcnJvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5fbWVzc2FnZUV4cHJlc3Npb24pXHJcbiAgICAgICAgICAgIHRoaXMuX2lzUGFzc2VkRXhwcmVzc2lvbiA9IHRoaXMuZXhlY3V0ZUV4cHJlc3Npb24odGhpcy5fbWVzc2FnZUV4cHJlc3Npb24sIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRDbGFzc05hbWUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgJiYgdHlwZW9mIHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbih0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uLCB0aGlzKTtcclxuICAgICAgICAgICAgbGV0IHVwZGF0ZUVsZW1lbnQgPSB0aGlzLnVwZGF0ZU9uRWxlbWVudENsYXNzIGFzIEZ1bmN0aW9uO1xyXG4gICAgICAgICAgICB1cGRhdGVFbGVtZW50KGNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgIG1hcmtBc1RvdWNoZWQob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMudG91Y2hlZDtcclxuICAgICAgICBzdXBlci5tYXJrQXNUb3VjaGVkKG9wdHMpO1xyXG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUgIT0gdGhpcy50b3VjaGVkKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbVE9VQ0hFRCwgVU5UT1VDSEVEXSlcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzVW50b3VjaGVkKG9wdHM/OiB7XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgfSk6IHZvaWQge1xyXG4gICAgICAgIGxldCBjdXJyZW50U3RhdGUgPSB0aGlzLnVudG91Y2hlZDtcclxuICAgICAgICBzdXBlci5tYXJrQXNVbnRvdWNoZWQob3B0cyk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLnVudG91Y2hlZClcclxuICAgICAgICAgICAgdGhpcy5ydW5Db250cm9sUHJvcENoYW5nZUV4cHJlc3Npb24oW1VOVE9VQ0hFRCwgVE9VQ0hFRF0pXHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzRGlydHkob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMuZGlydHk7XHJcbiAgICAgICAgc3VwZXIubWFya0FzRGlydHkob3B0cyk7XHJcbiAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLmRpcnR5KVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbRElSVFldKVxyXG4gICAgfVxyXG5cclxuICAgIG1hcmtBc1ByaXN0aW5lKG9wdHM/OiB7XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgfSk6IHZvaWQge1xyXG4gICAgICAgIGxldCBjdXJyZW50U3RhdGUgPSB0aGlzLnByaXN0aW5lO1xyXG4gICAgICAgIHN1cGVyLm1hcmtBc0RpcnR5KG9wdHMpO1xyXG4gICAgICAgIGlmIChjdXJyZW50U3RhdGUgIT0gdGhpcy5wcmlzdGluZSlcclxuICAgICAgICAgICAgdGhpcy5ydW5Db250cm9sUHJvcENoYW5nZUV4cHJlc3Npb24oW1BSSVNUSU5FXSlcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNQZW5kaW5nKG9wdHM/OiB7XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgICAgIGVtaXRFdmVudD86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMucGVuZGluZztcclxuICAgICAgICBzdXBlci5tYXJrQXNEaXJ0eShvcHRzKTtcclxuICAgICAgICBpZiAoY3VycmVudFN0YXRlICE9IHRoaXMucGVuZGluZylcclxuICAgICAgICAgICAgdGhpcy5ydW5Db250cm9sUHJvcENoYW5nZUV4cHJlc3Npb24oW1BFTkRJTkddKVxyXG4gICAgfVxyXG5cclxuICAgIHJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihwcm9wTmFtZXM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgcHJvcE5hbWVzLmZvckVhY2gobmFtZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICgodGhpcy5fY29udHJvbFByb3AgJiYgdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgdGhpcy5fY29udHJvbFByb3BbbmFtZV0pIHx8ICghdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgdGhpcy5jaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkpKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kRXJyb3IoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2NsYXNzTmFtZUNvbnRyb2xQcm9wICYmIHRoaXMuX2NsYXNzTmFtZUNvbnRyb2xQcm9wW25hbWVdKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kQ2xhc3NOYW1lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaCgpIHtcclxuICAgICAgICB0aGlzLmdldE1lc3NhZ2VFeHByZXNzaW9uKDxGb3JtR3JvdXA+dGhpcy5wYXJlbnQsIHRoaXMua2V5TmFtZSk7XHJcbiAgICAgICAgdGhpcy5iaW5kQ29uZGl0aW9uYWxDb250cm9scyhERUNPUkFUT1JTLmRpc2FibGVkLCBcIl9yZWZEaXNhYmxlQ29udHJvbHNcIik7XHJcbiAgICAgICAgdGhpcy5iaW5kQ29uZGl0aW9uYWxDb250cm9scyhERUNPUkFUT1JTLmVycm9yLCBcIl9yZWZNZXNzYWdlQ29udHJvbHNcIik7XHJcbiAgICAgICAgdGhpcy5iaW5kQ29uZGl0aW9uYWxDb250cm9scyhERUNPUkFUT1JTLmVsZW1lbnRDbGFzcywgXCJfcmVmQ2xhc3NOYW1lQ29udHJvbHNcIik7XHJcbiAgICAgICAgdGhpcy5leGVjdXRlRXhwcmVzc2lvbnMoKTtcclxuICAgICAgICB0aGlzLmJpbmRFcnJvcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0KHZhbHVlPzogYW55KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh0aGlzLmdldEZvcm1TdGF0ZSh0aGlzLl9iYXNlVmFsdWUpKTtcclxuICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWl0KCkge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5jYWxsUGF0Y2goKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGxQYXRjaCgpIHtcclxuICAgICAgICB0aGlzLl9pc01vZGlmaWVkID0gdGhpcy5nZXRWYWx1ZSh0aGlzLl9iYXNlVmFsdWUpICE9IHRoaXMuZ2V0VmFsdWUodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50W1BBVENIXSlcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnRbUEFUQ0hdKHRoaXMua2V5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkge1xyXG4gICAgICAgIGxldCBpc0JpbmQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgIGNhc2UgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5Lk9uU3VibWl0OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gKDxhbnk+dGhpcy5wYXJlbnQpLnN1Ym1pdHRlZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PbkRpcnR5OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gdGhpcy5kaXJ0eTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PblRvdWNoZWQ6XHJcbiAgICAgICAgICAgICAgICBpc0JpbmQgPSB0aGlzLnRvdWNoZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBFcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3kuT25EaXJ0eU9yVG91Y2hlZDpcclxuICAgICAgICAgICAgICAgIGlzQmluZCA9IHRoaXMuZGlydHkgfHwgdGhpcy50b3VjaGVkO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5Lk9uRGlydHlPclN1Ym1pdDpcclxuICAgICAgICAgICAgICAgIGlzQmluZCA9IHRoaXMuZGlydHkgfHwgKDxhbnk+dGhpcy5wYXJlbnQpLnN1Ym1pdHRlZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PblRvdWNoZWRPclN1Ym1pdDpcclxuICAgICAgICAgICAgICAgIGlzQmluZCA9IHRoaXMudG91Y2hlZCB8fCAoPGFueT50aGlzLnBhcmVudCkuc3VibWl0dGVkO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpc0JpbmQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNCaW5kO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZXhlY3V0ZUV4cHJlc3Npb25zKCkge1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc0V4cHJlc3Npb24oXCJfcmVmRGlzYWJsZUNvbnRyb2xzXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZNZXNzYWdlQ29udHJvbHNcIiwgXCJiaW5kRXJyb3JcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZDbGFzc05hbWVDb250cm9sc1wiLCBcImJpbmRDbGFzc05hbWVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNZXNzYWdlRXhwcmVzc2lvbihmb3JtR3JvdXA6IEZvcm1Hcm91cCwga2V5TmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGZvcm1Hcm91cFtNT0RFTF9JTlNUQU5DRV0pIHtcclxuICAgICAgICAgICAgbGV0IGluc3RhbmNlQ29udGFpbmVyID0gZGVmYXVsdENvbnRhaW5lci5nZXQoZm9ybUdyb3VwW01PREVMX0lOU1RBTkNFXS5jb25zdHJ1Y3Rvcik7XHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZUNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gPSBpbnN0YW5jZUNvbnRhaW5lci5ub25WYWxpZGF0aW9uRGVjb3JhdG9ycy5lcnJvci5jb25kaXRpb25hbEV4cHJlc3Npb25zW2tleU5hbWVdXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jb250cm9sUHJvcCA9IGluc3RhbmNlQ29udGFpbmVyLm5vblZhbGlkYXRpb25EZWNvcmF0b3JzLmVycm9yLmNvbnRyb2xQcm9wW3RoaXMua2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uID0gaW5zdGFuY2VDb250YWluZXIubm9uVmFsaWRhdGlvbkRlY29yYXRvcnMuZWxlbWVudENsYXNzLmNvbmRpdGlvbmFsRXhwcmVzc2lvbnNba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGFzc05hbWVDb250cm9sUHJvcCA9IGluc3RhbmNlQ29udGFpbmVyLm5vblZhbGlkYXRpb25EZWNvcmF0b3JzLmVsZW1lbnRDbGFzcy5jb250cm9sUHJvcFtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFNhbml0aXplZFZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBzYW5pdGl6ZXIgb2YgdGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBTQU5JVElaRVJTW3Nhbml0aXplci5uYW1lXSh2YWx1ZSwgc2FuaXRpemVyLmNvbmZpZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZENvbmRpdGlvbmFsQ29udHJvbHMoZGVjb3JhdG9yVHlwZTogc3RyaW5nLCByZWZOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9kaXNhYmxlUHJvdmlkZXIgPSBuZXcgRGlzYWJsZVByb3ZpZGVyKGRlY29yYXRvclR5cGUsIHRoaXMuZW50aXR5T2JqZWN0KTtcclxuICAgICAgICB0aGlzW3JlZk5hbWVdID0gdGhpcy5fZGlzYWJsZVByb3ZpZGVyLnplcm9Bcmd1bWVudFByb2Nlc3ModGhpcywgdGhpcy5rZXlOYW1lKVxyXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQcm92aWRlci5vbmVBcmd1bWVudFByb2Nlc3ModGhpcywgYCR7dGhpcy5rZXlOYW1lfSR7UlhDT0RFfTFgKS5mb3JFYWNoKHQgPT4gdGhpc1tyZWZOYW1lXS5wdXNoKHQpKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldENvbnRyb2xFcnJvck1lc3NhZ2VzKCkge1xyXG4gICAgICAgIGlmICgoIXRoaXMuX21lc3NhZ2VFeHByZXNzaW9uICYmIHRoaXMuY2hlY2tFcnJvck1lc3NhZ2VTdHJhdGVneSgpKSB8fCB0aGlzLl9pc1Bhc3NlZEV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lcnJvcnMpIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuZXJyb3JzKS5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFtDT05UUk9MU19FUlJPUl1bdGhpcy5rZXlOYW1lXSA9IHRoaXMuX2Vycm9yTWVzc2FnZSA9IHRoaXMuZ2V0RXJyb3JNZXNzYWdlKHRoaXMuZXJyb3JzLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9lcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlcnJvck9iamVjdCA9IE9iamVjdE1ha2VyLnRvSnNvbih0LCB1bmRlZmluZWQsIFt0aGlzLmVycm9yc1t0XVt0XV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV0gPSB0aGlzLl9lcnJvck1lc3NhZ2UgPSB0aGlzLmdldEVycm9yTWVzc2FnZShlcnJvck9iamVjdCwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gdGhpcy5nZXRFcnJvck1lc3NhZ2UodGhpcy5lcnJvcnMsIHQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlcy5wdXNoKHRoaXMuX2Vycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV0gPSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuX2Vycm9yTWVzc2FnZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RXJyb3JNZXNzYWdlKGVycm9yT2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBrZXlOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoZXJyb3JPYmplY3Rba2V5TmFtZV1bTUVTU0FHRV0pXHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvck9iamVjdFtrZXlOYW1lXVtNRVNTQUdFXTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIHByb2Nlc3NFeHByZXNzaW9uKHByb3BOYW1lOiBzdHJpbmcsIG9wZXJhdGlvblR5cGU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzW3Byb3BOYW1lXSlcclxuICAgICAgICAgICAgZm9yICh2YXIgY29udHJvbEluZm8gb2YgdGhpc1twcm9wTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgIGxldCBjb250cm9sID0gY29udHJvbEluZm8uaXNSb290ID8gQXBwbGljYXRpb25VdGlsLmdldENvbnRyb2woY29udHJvbEluZm8uY29udHJvbFBhdGgsIEFwcGxpY2F0aW9uVXRpbC5nZXRSb290Rm9ybUdyb3VwKHRoaXMpKSA6IEFwcGxpY2F0aW9uVXRpbC5nZXRGb3JtQ29udHJvbChjb250cm9sSW5mby5jb250cm9sUGF0aCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb25UeXBlID09IFwiZGlzYWJsZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbihjb250cm9sSW5mby5jb25kaXRpb25hbEV4cHJlc3Npb24sIGNvbnRyb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5kaXNhYmxlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5lbmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvblR5cGUgPT0gXCJiaW5kRXJyb3JcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5iaW5kRXJyb3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvcGVyYXRpb25UeXBlID09IFwiYmluZENsYXNzTmFtZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sLmJpbmRDbGFzc05hbWUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGV4ZWN1dGVFeHByZXNzaW9uKGV4cHJlc3Npb246IEZ1bmN0aW9uLCBjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBCb29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbi5jYWxsKGNvbnRyb2wucGFyZW50W01PREVMX0lOU1RBTkNFXSwgY29udHJvbCwgQXBwbGljYXRpb25VdGlsLmdldFBhcmVudE1vZGVsSW5zdGFuY2VWYWx1ZSh0aGlzKSwgY29udHJvbC5wYXJlbnRbTU9ERUxfSU5TVEFOQ0VdKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSBcIlwiID8gdmFsdWUgOiBcIlwiO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=